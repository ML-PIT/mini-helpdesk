{% extends "base.html" %}

{% block title %}Dashboard - ML Gruppe Helpdesk{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">
            <i class="bi bi-speedometer2"></i> Dashboard
            <small class="text-muted">Willkommen, {{ current_user.full_name }}!</small>
        </h1>
    </div>
</div>

<div class="row">
    {% if current_user.role == 'customer' %}
        <!-- Customer Dashboard -->
        <div class="col-md-4">
            <div class="card text-white bg-primary">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h5 class="card-title">Meine Tickets</h5>
                            <h2>{{ stats.my_tickets or 0 }}</h2>
                        </div>
                        <div class="align-self-center">
                            <i class="bi bi-ticket" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card text-white bg-success">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h5 class="card-title">Offene Tickets</h5>
                            <h2>{{ stats.open_tickets or 0 }}</h2>
                        </div>
                        <div class="align-self-center">
                            <i class="bi bi-clock" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card text-white bg-info">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h5 class="card-title">Gelöste Tickets</h5>
                            <h2>{{ stats.resolved_tickets or 0 }}</h2>
                        </div>
                        <div class="align-self-center">
                            <i class="bi bi-check-circle" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% else %}
        <!-- Agent/Admin Dashboard -->
        <div class="col-md-3">
            <div class="card text-white bg-primary">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h5 class="card-title">Gesamt Tickets</h5>
                            <h2>{{ stats.total_tickets or 0 }}</h2>
                        </div>
                        <div class="align-self-center">
                            <i class="bi bi-ticket" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="card text-white bg-warning">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h5 class="card-title">Offene Tickets</h5>
                            <h2>{{ stats.open_tickets or 0 }}</h2>
                        </div>
                        <div class="align-self-center">
                            <i class="bi bi-clock" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="card text-white bg-info">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h5 class="card-title">In Bearbeitung</h5>
                            <h2>{{ stats.pending_tickets or 0 }}</h2>
                        </div>
                        <div class="align-self-center">
                            <i class="bi bi-arrow-repeat" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="card text-white bg-success">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h5 class="card-title">Heute gelöst</h5>
                            <h2>{{ stats.resolved_today or 0 }}</h2>
                        </div>
                        <div class="align-self-center">
                            <i class="bi bi-check-circle" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        {% if current_user.role == 'support_agent' %}
        <div class="col-md-6 mt-3">
            <div class="card text-white bg-secondary">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h5 class="card-title">Mir zugewiesene Tickets</h5>
                            <h2>{{ stats.my_assigned or 0 }}</h2>
                        </div>
                        <div class="align-self-center">
                            <i class="bi bi-person-check" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    {% endif %}
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="bi bi-list"></i> Schnellaktionen
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-2">
                        <a href="{{ url_for('tickets.create_ticket') }}" class="btn btn-primary w-100">
                            <i class="bi bi-plus-circle"></i> Neues Ticket
                        </a>
                    </div>
                    <div class="col-md-3 mb-2">
                        <a href="{{ url_for('knowledge.public_knowledge') }}" class="btn btn-info w-100">
                            <i class="bi bi-book"></i> Knowledge Base
                        </a>
                    </div>
                    {% if current_user.role == 'customer' %}
                    <div class="col-md-3 mb-2">
                        <a href="{{ url_for('customer.my_tickets') }}" class="btn btn-success w-100">
                            <i class="bi bi-ticket"></i> Meine Tickets
                        </a>
                    </div>
                    {% else %}
                    <div class="col-md-3 mb-2">
                        <a href="{{ url_for('tickets.list_tickets') }}" class="btn btn-success w-100">
                            <i class="bi bi-ticket"></i> Alle Tickets
                        </a>
                    </div>
                    {% endif %}
                    <div class="col-md-3 mb-2">
                        <a href="{{ url_for('knowledge.faq') }}" class="btn btn-warning w-100">
                            <i class="bi bi-question-circle"></i> FAQ
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% if current_user.role in ['admin', 'team_leader'] %}
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-graph-up"></i> System-Übersicht
                </h5>
            </div>
            <div class="card-body">
                <p class="text-muted">
                    Das ML Gruppe Helpdesk System ist betriebsbereit und funktionsfähig.
                    {% if stats.get('sla_breached', 0) > 0 %}
                    <span class="badge bg-warning">{{ stats.sla_breached }} SLA-Verletzungen</span>
                    {% endif %}
                </p>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}