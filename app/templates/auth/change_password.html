{% extends "base.html" %}

{% block title %}Passwort ändern - ML Gruppe Helpdesk{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 mb-0">
        <i class="bi bi-shield-lock"></i> Passwort ändern
    </h1>
    <a href="{{ url_for('auth.profile') }}" class="btn btn-secondary">
        <i class="bi bi-arrow-left"></i> Zurück zum Profil
    </a>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-key"></i> Neues Passwort festlegen
                </h5>
            </div>
            <div class="card-body">
                {% if current_user.microsoft_id %}
                <div class="alert alert-warning" role="alert">
                    <i class="bi bi-exclamation-triangle"></i>
                    <strong>Microsoft Konto erkannt:</strong> Passwort-Änderungen sind für Microsoft-Konten nicht verfügbar. 
                    Bitte verwenden Sie die Microsoft-Kontoverwaltung, um Ihr Passwort zu ändern.
                </div>
                
                <div class="text-center">
                    <a href="https://account.microsoft.com/" target="_blank" class="btn btn-primary">
                        <i class="bi bi-microsoft"></i> Microsoft Konto verwalten
                    </a>
                </div>
                {% else %}
                <form method="POST">
                    {{ form.hidden_tag() }}
                    
                    <div class="mb-3">
                        {{ form.current_password.label(class="form-label") }}
                        {{ form.current_password(class="form-control") }}
                        {% for error in form.current_password.errors %}
                            <div class="text-danger small">{{ error }}</div>
                        {% endfor %}
                        <div class="form-text">Geben Sie Ihr aktuelles Passwort zur Bestätigung ein</div>
                    </div>
                    
                    <div class="mb-3">
                        {{ form.new_password.label(class="form-label") }}
                        {{ form.new_password(class="form-control") }}
                        {% for error in form.new_password.errors %}
                            <div class="text-danger small">{{ error }}</div>
                        {% endfor %}
                        <div class="form-text">
                            Das Passwort sollte mindestens 8 Zeichen lang sein und Groß- und Kleinbuchstaben, 
                            Zahlen und Sonderzeichen enthalten.
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        {{ form.confirm_password.label(class="form-label") }}
                        {{ form.confirm_password(class="form-control") }}
                        {% for error in form.confirm_password.errors %}
                            <div class="text-danger small">{{ error }}</div>
                        {% endfor %}
                    </div>
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{{ url_for('auth.profile') }}" class="btn btn-secondary me-md-2">Abbrechen</a>
                        <button type="submit" class="btn btn-warning">
                            <i class="bi bi-shield-check"></i> Passwort ändern
                        </button>
                    </div>
                </form>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <!-- Password Security Tips -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-shield-check"></i> Passwort Sicherheit
                </h5>
            </div>
            <div class="card-body">
                <h6>Tipps für ein sicheres Passwort:</h6>
                <ul class="small">
                    <li>Mindestens 8 Zeichen lang</li>
                    <li>Kombination aus Groß- und Kleinbuchstaben</li>
                    <li>Zahlen und Sonderzeichen verwenden</li>
                    <li>Keine persönlichen Informationen</li>
                    <li>Nicht in anderen Diensten verwenden</li>
                    <li>Regelmäßig ändern</li>
                </ul>
                
                <div class="alert alert-info small mt-3" role="alert">
                    <i class="bi bi-lightbulb"></i>
                    <strong>Tipp:</strong> Verwenden Sie einen Passwort-Manager für maximale Sicherheit.
                </div>
            </div>
        </div>
        
        <!-- Account Security Status -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-shield"></i> Konto Sicherheit
                </h5>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="small">E-Mail Verifikation</span>
                    {% if current_user.email_verified %}
                        <span class="badge bg-success">✓</span>
                    {% else %}
                        <span class="badge bg-warning">⚠</span>
                    {% endif %}
                </div>
                
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="small">Starkes Passwort</span>
                    <span class="badge bg-secondary">?</span>
                </div>
                
                <div class="d-flex justify-content-between align-items-center">
                    <span class="small">Zwei-Faktor-Auth</span>
                    <span class="badge bg-secondary">Nicht verfügbar</span>
                </div>
                
                <hr>
                
                <small class="text-muted">
                    <strong>Letztes Passwort Update:</strong><br>
                    Information nicht verfügbar
                </small>
            </div>
        </div>
        
        <!-- Help -->
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-question-circle"></i> Benötigen Sie Hilfe?
                </h5>
            </div>
            <div class="card-body">
                <p class="small">Falls Sie Probleme beim Passwort ändern haben:</p>
                <div class="d-grid gap-2">
                    <a href="{{ url_for('tickets.create_ticket') }}" class="btn btn-outline-primary btn-sm">
                        <i class="bi bi-plus-circle"></i> Support Ticket
                    </a>
                    <a href="{{ url_for('knowledge.faq') }}" class="btn btn-outline-info btn-sm">
                        <i class="bi bi-question-circle"></i> FAQ
                    </a>
                </div>
                
                <hr>
                
                <small class="text-muted">
                    <strong>Vergessen Sie nicht:</strong> Nach der Passwort-Änderung müssen Sie sich möglicherweise 
                    in anderen Geräten neu anmelden.
                </small>
            </div>
        </div>
    </div>
</div>
{% endblock %}