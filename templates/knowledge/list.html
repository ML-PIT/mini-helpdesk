{% extends 'base.html' %}

{% block title %}FAQ & Wissensdatenbank - {{ app_title }}{% endblock %}

{% block content %}
<div class="flex justify-between" style="align-items: center; margin-bottom: 20px;">
    <h1 style="font-size: 28px; font-weight: 600;">FAQ & Wissensdatenbank</h1>
    {% if user.role == 'support_agent' and user.support_level >= 2 or user.role == 'admin' %}
    <a href="{% url 'knowledge:create' %}" class="btn btn-primary">+ Neuer Artikel</a>
    {% endif %}
</div>

<!-- Search Bar -->
<div class="card" style="margin-bottom: 20px;">
    <form method="get" action="{% url 'knowledge:list' %}">
        <div style="display: flex; gap: 10px;">
            <input type="text" name="q" class="form-control" placeholder="Suche nach Artikeln..." value="{{ search_query }}" style="flex: 1;">
            <select name="category" class="form-control" style="width: 200px;">
                <option value="">Alle Kategorien</option>
                {% for category in categories %}
                <option value="{{ category.id }}" {% if selected_category == category.id|stringformat:"s" %}selected{% endif %}>
                    {{ category.name }}
                </option>
                {% endfor %}
            </select>
            <button type="submit" class="btn btn-primary">Suchen</button>
        </div>
    </form>
</div>

<!-- Featured Articles -->
{% if featured and not search_query %}
<div class="card" style="margin-bottom: 30px;">
    <h2 style="font-size: 20px; font-weight: 600; margin-bottom: 15px;">‚≠ê H√§ufig gestellte Fragen</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
        {% for article in featured %}
        <a href="{% url 'knowledge:detail' article.slug %}" style="text-decoration: none;">
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 8px; transition: transform 0.2s;">
                <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">{{ article.title }}</h3>
                <p style="font-size: 14px; opacity: 0.9; line-height: 1.5;">{{ article.excerpt|truncatewords:15 }}</p>
                <div style="margin-top: 10px; font-size: 12px; opacity: 0.8;">
                    üëÅÔ∏è {{ article.views }} Aufrufe
                </div>
            </div>
        </a>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- All Articles -->
{% if articles %}
<div class="card">
    <h2 style="font-size: 18px; font-weight: 600; margin-bottom: 20px;">
        {% if search_query %}
            Suchergebnisse f√ºr "{{ search_query }}"
        {% else %}
            Alle Artikel
        {% endif %}
    </h2>

    <div style="display: flex; flex-direction: column; gap: 15px;">
        {% for article in articles %}
        <div style="border: 1px solid #e9ecef; border-radius: 8px; padding: 20px; transition: box-shadow 0.2s;">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                <div style="flex: 1;">
                    <a href="{% url 'knowledge:detail' article.slug %}" style="text-decoration: none; color: #667eea; font-size: 18px; font-weight: 600;">
                        {{ article.title }}
                    </a>
                    {% if article.category %}
                    <span style="margin-left: 10px; padding: 3px 10px; background: {{ article.category.color }}20; color: {{ article.category.color }}; border-radius: 12px; font-size: 12px; font-weight: 600;">
                        {{ article.category.name }}
                    </span>
                    {% endif %}
                    {% if not article.is_public %}
                    <span style="margin-left: 5px; padding: 3px 10px; background: #ff6b6b; color: white; border-radius: 12px; font-size: 12px; font-weight: 600;">
                        Intern
                    </span>
                    {% endif %}
                </div>
                <div style="text-align: right; color: #868e96; font-size: 13px;">
                    <div>{{ article.published_at|date:"d.m.Y" }}</div>
                    <div>üëÅÔ∏è {{ article.views }}</div>
                </div>
            </div>

            {% if article.excerpt %}
            <p style="color: #495057; line-height: 1.6; margin-bottom: 10px;">
                {{ article.excerpt }}
            </p>
            {% endif %}

            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px; padding-top: 15px; border-top: 1px solid #f0f0f0;">
                <div style="font-size: 13px; color: #868e96;">
                    Von {{ article.author.full_name }}
                </div>
                <div style="font-size: 13px;">
                    {% if article.helpful_count > 0 or article.not_helpful_count > 0 %}
                    <span style="color: #51cf66;">üëç {{ article.helpful_count }}</span>
                    <span style="margin-left: 10px; color: #ff6b6b;">üëé {{ article.not_helpful_count }}</span>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% else %}
<div class="card">
    <div class="empty-state">
        <div class="empty-state-icon">üìö</div>
        <h2 style="margin-bottom: 10px; color: #495057;">Keine Artikel gefunden</h2>
        <p style="color: #868e96;">
            {% if search_query %}
                Keine Artikel gefunden f√ºr "{{ search_query }}". Versuchen Sie einen anderen Suchbegriff.
            {% else %}
                Es sind noch keine Artikel in der Wissensdatenbank vorhanden.
            {% endif %}
        </p>
    </div>
</div>
{% endif %}
{% endblock %}
